var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s;import{p as r,e as n,X as u,I as c,f as d,R as v,G as p,H as m,Z as f,ab as y,v as h,P as b,U as g,W as k,a4 as w,a5 as V,a6 as _,a7 as O,o as j,A as I,i as x,B as P,a2 as C,a3 as U,h as q,w as z,t as F,k as G,j as L,c as E,Q as M,K as S,L as A}from"./vendor-14dfef14.js";import{h as B,p as D}from"./index-c024a321.js";import{d as H}from"./index-f917b9a7.js";r("data-v-7536129c");const K={class:"survey-wrapper"},Q={key:0,class:"container"},R={key:1,class:"container"},T={key:2,class:"container"},W={key:3,class:"container"},X={class:"success-result"},Z=L(" 继续投票 "),$={class:"content-wrapper"},J={class:"begin-content"},N=q("div",{class:"desc"},"欢迎参与本次投票，现在我们就马上开始吧！",-1),Y={class:"check-content"},ee={class:"mail-check"},ae=q("div",{class:"line"},null,-1),le={class:"main-content"},se={class:"tip"},te=q("span",{class:"dot"},"*",-1),oe={class:"footer"},ie=L(" 提交 "),re=q("footer",null,[q("p",null,"© GGS · 甄步绰小组")],-1);n();const ne={setup(e){const r=u(),n=window.atob(r.params.id),ne=c({}),ue=c(!1),ce=c(""),de=c([]),ve=d((()=>0===ne.value.isMultiple?"请选择一个选项":"请选择一个或者多个选项")),pe=v({email:"",phone:""}),me=c(null),fe=c(!1),ye=c(!1);p((async()=>{const e=m.service({fullscreen:!0,lock:!0,text:"加载中"});try{const a=await B(n);200==a.code?(ne.value=a.data,document.title=ne.value.name):ye.value=!0}catch(a){}finally{e.close()}}));const he=v({email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"},{validator:(e,a,l)=>{/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/.test(a)?l():l(new Error("请输入正确的手机号码"))},trigger:["blur","change"]}]}),be=c([]);f(ce,(e=>{be.value=[{checkContent:pe.email||pe.phone,optionId:e,questionId:n}]})),f(pe,H((e=>{if(!be.value.length)return!1;be.value=be.value.map((r=>{return n=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&i(e,l,a[l]);if(s)for(var l of s(a))o.call(a,l)&&i(e,l,a[l]);return e})({},r),u={checkContent:2==ne.value.checkId?e.email:e.phone},a(n,l(u));var n,u}))}),500)),f(de,(e=>{be.value=e.map((e=>({checkContent:pe.email||pe.phone,optionId:e,questionId:n})))}));const ge=()=>{fe.value=!1,location.reload()},ke=()=>{me.value.validate((async e=>{if(!e)return M.error("请输入有效的表单"),me.value.resetFields(),!1;if(ce.value||de.value.length){ue.value=!0;const e=m.service({fullscreen:!0,lock:!0,text:"提交中"}),a=await D(be.value);200==a.code?fe.value=!0:M.error(a.message),ce.value="",de.value=[],e.close(),me.value.resetFields()}else M.error("请投入宝贵的一票哟");ue.value=!1}))};return(e,a)=>{const l=y,s=h,t=b,o=g,i=k,r=w,n=V,u=_,c=O;return j(),I("div",K,[ye.value?(j(),I("div",Q,[x(l,{icon:"error",title:"抱歉，没有该问卷地址，请输入正确的地址！"})])):P("",!0),2==ne.value.status?(j(),I("div",R,[x(l,{icon:"warning",title:"抱歉，该投票问卷已过期！"})])):P("",!0),0==ne.value.status?(j(),I("div",T,[x(l,{icon:"warning",title:"抱歉，该投票问卷暂未发布！"})])):P("",!0),1==ne.value.status?(j(),I("div",W,[C(q("div",X,[x(l,{icon:"success",title:"投票成功",subTitle:"感谢您的帮助与支持，点击继续投票即可再次进行投票"},{extra:z((()=>[x(s,{onClick:ge,type:"primary",size:"medium"},{default:z((()=>[Z])),_:1})])),_:1})],512),[[U,fe.value]]),C(q("div",$,[q("div",J,[q("p",null,F(ne.value.name),1),N,q("div",Y,[q("div",ee,[x(i,{model:G(pe),ref:(e,a)=>{a.checkValidateForm=e,me.value=e},size:"mini",style:{width:"300px"},rules:G(he)},{default:z((()=>[2==ne.value.checkId?(j(),E(o,{key:0,prop:"email",label:"邮箱"},{default:z((()=>[x(t,{modelValue:G(pe).email,"onUpdate:modelValue":a[0]||(a[0]=e=>G(pe).email=e)},null,8,["modelValue"])])),_:1})):P("",!0),3==ne.value.checkId?(j(),E(o,{key:1,prop:"phone",label:"手机号码"},{default:z((()=>[x(t,{modelValue:G(pe).phone,"onUpdate:modelValue":a[1]||(a[1]=e=>G(pe).phone=e)},null,8,["modelValue"])])),_:1})):P("",!0)])),_:1},8,["model","rules"])])]),ae]),q("div",le,[q("h4",se,[L(F(G(ve))+" ",1),te]),0===ne.value.isMultiple?(j(),E(n,{key:0,modelValue:ce.value,"onUpdate:modelValue":a[2]||(a[2]=e=>ce.value=e)},{default:z((()=>[(j(!0),I(S,null,A(ne.value.optionVOList,(e=>(j(),I("div",{key:e.id},[x(r,{label:e.id},{default:z((()=>[L(F(e.name),1)])),_:2},1032,["label"])])))),128))])),_:1},8,["modelValue"])):(j(),E(c,{key:1,modelValue:de.value,"onUpdate:modelValue":a[3]||(a[3]=e=>de.value=e)},{default:z((()=>[(j(!0),I(S,null,A(ne.value.optionVOList,(e=>(j(),I("div",{key:e.id},[x(u,{label:e.id},{default:z((()=>[L(F(e.name),1)])),_:2},1032,["label"])])))),128))])),_:1},8,["modelValue"]))]),q("div",oe,[x(s,{onClick:ke,style:{width:"100px"},type:"primary",size:"medium",loading:ue.value},{default:z((()=>[ie])),_:1},8,["loading"])])],512),[[U,!fe.value]])])):P("",!0),re])}},__scopeId:"data-v-7536129c"};export{ne as default};
