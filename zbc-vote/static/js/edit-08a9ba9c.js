var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{p as n,e as u,a8 as d,I as r,f as c,z as p,o as v,A as m,h as f,i as y,w as b,a2 as x,a3 as h,v as g,k as w,Y as V,X as k,R as M,G as O,H as j,Z as D,a4 as I,a5 as _,a9 as T,M as U,O as C,aa as $,K as P,L as Y,m as q,Q as z,c as B,j as E}from"./vendor-14dfef14.js";import{u as F}from"./vote-9bc7bf17.js";import{d as H}from"./index-f917b9a7.js";import{f as L}from"./index-c024a321.js";n("data-v-4302d7ce");const R=["value"];u();const S={props:{text:{type:String},id:{type:String},isMultiple:{type:Number}},setup(e){const a=e;d((e=>({f9efa6f4:w(s)})));const t=r(!1),l=r(void 0),s=c((()=>0===a.isMultiple?"50%":"20%")),o=r(!1),i=()=>{o.value=!0},n=()=>{o.value=!1},u=()=>{l.value===document.activeElement?l.value.style.border="1px solid #f4f4f4":(l.value.style.border="1px dashed #ccc",t.value=!0)},V=()=>{l.value===document.activeElement?(l.value.style.border="1px solid #f4f4f4",t.value=!0):(l.value.style.border="1px solid #fff",t.value=!1)},k=()=>{l.value.style.border="1px solid #fff",t.value=!1},M=()=>{l.value.style.border="1px solid #f4f4f4"};return(a,s)=>{const d=g,r=p;return v(),m("div",{class:"radio-container",onMouseover:u,onMouseout:V},[f("input",{onBlur:k,onFocus:M,onChange:s[0]||(s[0]=t=>{""===t.target.value?(t.target.value="选项",a.$emit("update:text","选项"),a.$emit("change-text",{id:e.id,text:t.target.value})):(a.$emit("update:text",t.target.value),a.$emit("changeText",{id:e.id,text:t.target.value}))}),value:e.text,ref:(e,a)=>{a.conRef=e,l.value=e},class:"input-dynamic-radio"},null,40,R),y(r,{effect:"dark",content:"删除",placement:"top"},{default:b((()=>[x(y(d,{circle:"",icon:"el-icon-minus",size:"mini",type:o.value?"danger":"info",onMouseenter:i,onMouseleave:n,onClick:s[1]||(s[1]=t=>a.$emit("remove",e.id))},null,8,["type"]),[[h,t.value]])])),_:1})],32)}},__scopeId:"data-v-4302d7ce"};n("data-v-4e86443d");const A={class:"main"},G={class:"el-aside"},K=f("h4",null,"投票类型",-1),N=E("单选"),Q=E("多选"),X=f("h4",null,"投票过期时间",-1),Z=f("h4",null,"投票检查类型",-1),J={class:"el-main"},W={class:"vote-main"},ee={class:"bottom-left"},ae={class:"question-box"},te={class:"question-choose"},le={class:"add-option"},se=E(" 添加单个选项 "),oe=E(" 发布并分享 ");u();const ie={setup(e){const n=V(),u=k(),{getVoteDetail:d,updateVote:p,updateVoteForAddOption:E,updateVoteForDelOption:R,updateVoteForUptOption:ie}=F(),ne=r(!0),ue=M({}),de=r([]),re=c((()=>BigInt(u.params.id)));O((async()=>{const e=j.service({fullscreen:!0,lock:!0}),a=await d(re.value);Object.keys(a).forEach((e=>{"checkId"==e?ue[e]=parseInt(a[e]):"optionList"==e?de.value=a[e].map((e=>({id:e.id,name:e.name}))):ue[e]=a[e]})),e.close(),ne.value=!1})),D(ue,H((async(e,a)=>{new Date(e.expirationDate).getTime()>new Date(pe.value).getTime()?e.status=0:e.status=2,await p(re.value,e),await d(re.value)}),500));const ce=c((()=>n.state.checkList)),pe=r(new Date),ve=H((async({id:e,text:a})=>{await ie(e,a)}),500),me=async e=>{de.value=de.value.filter((a=>a.id!==e)),await R(e)},fe=async()=>{const e=await E({questionId:re.value+"",name:"选项"});de.value.push({id:e.id,name:e.name})},ye=()=>{q.confirm("确认是否发布此投票并分享?","发布确认",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((async()=>{var e,n;await p(re.value,(e=((e,a)=>{for(var t in a||(a={}))s.call(a,t)&&i(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&i(e,t,a[t]);return e})({},ue),n={status:1},a(e,t(n)))),L.replace(`/vote/publish/${re.value}`)})).catch((()=>{z({type:"info",message:"已取消发布"})}))};return(e,a)=>{const t=I,l=_,s=T,o=U,i=C,n=g;return x((v(),m("main",A,[f("aside",G,[f("div",null,[K,y(l,{modelValue:w(ue).isMultiple,"onUpdate:modelValue":a[0]||(a[0]=e=>w(ue).isMultiple=e),size:"mini"},{default:b((()=>[y(t,{label:0,border:""},{default:b((()=>[N])),_:1}),y(t,{label:1,border:""},{default:b((()=>[Q])),_:1})])),_:1},8,["modelValue"])]),f("div",null,[X,y(s,{modelValue:w(ue).expirationDate,"onUpdate:modelValue":a[1]||(a[1]=e=>w(ue).expirationDate=e),type:"datetime",placeholder:"选择日期时间","value-format":"YYYY-MM-DDTHH:mm:ss.000+00:00","default-time":pe.value},null,8,["modelValue","default-time"])]),f("div",null,[Z,y(i,{size:"mini",modelValue:w(ue).checkId,"onUpdate:modelValue":a[2]||(a[2]=e=>w(ue).checkId=e),placeholder:"请选择"},{default:b((()=>[(v(!0),m(P,null,Y(w(ce),(e=>(v(),B(o,{key:e.id,label:e.checkType,value:parseInt(e.id)},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])]),f("section",J,[f("div",W,[f("div",ee,[f("div",ae,[x(f("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>w(ue).name=e),class:"input-dynamic input-question"},null,512),[[$,w(ue).name]])]),f("div",te,[(v(!0),m(P,null,Y(de.value,(e=>(v(),B(S,{text:e.name,"onUpdate:text":a=>e.name=a,key:e.id,id:e.id,isMultiple:w(ue).isMultiple,onRemove:me,onChangeText:w(ve)},null,8,["text","onUpdate:text","id","isMultiple","onChangeText"])))),128))]),f("div",le,[y(n,{onClick:fe,type:"text",icon:"el-icon-plus"},{default:b((()=>[se])),_:1})])])]),y(n,{icon:"el-icon-s-promotion",type:"primary",onClick:ye,class:"share"},{default:b((()=>[oe])),_:1})])],512)),[[h,!ne.value]])}},__scopeId:"data-v-4e86443d"};export{ie as default};
